{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}

<link href="http://cdn.jsdelivr.net/timepicker.js/latest/timepicker.min.css" rel="stylesheet"/>

<body class="bg-gradient-dark">
    <div class="row justify-content-center">            
        <div class="col-xl-10 col-lg-12 col-md-9">                
            {% for message in messages %}
            <div class="alert {{ message.tags }} mb-4" role="alert">
                <strong>{{ message }}</strong>
            </div>
            {% endfor %}

            <div class="card o-hidden border-left-warning shadow-lg mb-5 pb-3">
                <div class="card-header text-center">
                    <h1 class="h4 text-gray-900 mt-2">Employees</h1>    
                    <p>Create new Employees</p>                                    
                </div>
                <div class="card-body p-0 px-2">                            
                    <div class="row">
                        <div class="col-lg-12">                                                                        
                            <h3 class="text-center py-3 font-weight-bold">Add New Employees</h3>                                                                                                                                                                                  
                            <form method="POST" action="" id="form-container">
                                {% csrf_token %}
                                {{ employee_formset.management_form }}
                                {% for form in employee_formset %}                                                    
                                <div class="dropdown-divider border border-warning"></div>                                                            
                                <div class="row users-form align-baseline border border-warning rounded pt-2 mb-3 mx-2">                                                
                                    <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2 form-group">
                                        {{ form.name| as_crispy_field }}
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-6 col-lg-4 col-xl-4 form-group">
                                        {{ form.ace| as_crispy_field }}
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-6 col-lg-3 col-xl-3 form-group">
                                        {{ form.card_number1| as_crispy_field }}
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-6 col-lg-3 col-xl-3 form-group">
                                        {{ form.card_number2| as_crispy_field }}
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-6 col-lg-3 col-xl-3 form-group">
                                        {{ form.card_number3| as_crispy_field }}
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-6 col-lg-3 col-xl-3 form-group">
                                        {{ form.team| as_crispy_field }}
                                    </div>                                                        
                                </div>
                                {% endfor %}
                                <button id="add-form-us" type="button" class="btn btn-success" hidden>Add Employee</button>                                                
                                <div class="row">
                                    <div class="col-4">
                                        <button id="add-form" type="button" class="btn btn-success">Add Employee</button>                                                
                                    </div>
                                    <div class="col-4">
                                        <button id="remove-form" type="button" class="btn btn-danger">Delete Employee</button>                                                
                                    </div>
                                    <div class="col-4">
                                        <button type="submit" class="btn btn-primary" name="save_users">Save Changes</button>
                                    </div>
                                </div>
                            </form>                                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    //Add User
    let UsersForm = document.querySelectorAll(".users-form")
    let container = document.querySelector("#form-container")
    let addButton = document.querySelector("#add-form")
    let addButton_us = document.querySelector("#add-form-us")
    let removeButton = document.querySelector("#remove-form")
    let totalForms = document.querySelector("#id_form-TOTAL_FORMS")

    let formNum = UsersForm.length-1
    addButton.addEventListener('click', addForm)
    removeButton.addEventListener('click', removeForm)

    function addForm(e){
        e.preventDefault()

        let newForm = UsersForm[0].cloneNode(true)
        let formRegex = RegExp(`form-(\\d){1}-`,'g')

        formNum++
        newForm.innerHTML = newForm.innerHTML.replace(formRegex, `form-${formNum}-`)    
        container.insertBefore(newForm, addButton_us)
        
        totalForms.setAttribute('value', `${formNum+1}`)        
    }

    function removeForm(e){
        e.preventDefault()
        let UsersForm2 = document.querySelectorAll(".users-form")
        let form = UsersForm2[formNum]
        form.remove()
        totalForms.setAttribute('value', `${formNum}`)
        formNum--
    }

    //Delete User
    $(document).on("click", "#UsersDialog", function() {        
        var myUserId = $(this).data('user-id');
        var myUserName = $(this).data('user-name');
        document.getElementById('userId').innerHTML = myUserName;   
        console.log(myUserId);
        $(".modal-body #userId").val(myUserName);
        var newAction = "/accounts/" + myUserId + "/delete_user/";
        console.log(newAction);
        document.getElementById("form_id_user").action = newAction;                                  
    });
</script>

{% endblock %}