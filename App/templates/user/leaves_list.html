{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}

<style>
    table.sortable th:not(.sorttable_sorted):not(.sorttable_sorted_reverse):not(.sorttable_nosort):after { 
    content: " \25B4\25BE" 
}
</style>


<div class="container-fluid">

    <div class="card shadow rounded">
      <div class="card-header text-center">
        <h1 class="h3 mb-2 text-gray-800 mt-3">Leaves List</h1>
        <p class="mb-4">List leaves currently active on this month</p>
      </div>
      <span class="border-top"></span>
      {% if messages %}
      <ul>
        {% for message in messages %}
        <div class="alert {{ message.tags }} mt-4 mb-2" role="alert">
            <strong>{{ message }}</strong>
        </div>
        {% endfor %}
      </ul>
      {% endif %}

      <!-- Data Table-->
      <div class="card-body">
        <div class="row">

            <!-- Topbar Search -->
            <div class="col-3 col-sm-5 col-md-5 col-lg-3 col-lx-3 d-flex justify-content-start mb-3">
                {% comment %}
                <form action="{% url 'search_guest' %}"
                    class="d-none d-sm-inline-block form-inline mr-auto ml-md-1 my-2 my-md-0 mw-100 navbar-search">
                    <div class="input-group">
                        <input name="searchGuest" type="text" class="form-control bg-light border-1 small" placeholder="Search Leave"
                            aria-label="Search" aria-describedby="basic-addon2">
                        <div class="input-group-append">
                            <button class="btn btn-dark" type="submit">
                                <i class="fas fa-search fa-sm"></i>
                            </button>
                        </div>
                    </div>
                </form>
                {% endcomment %}
            </div>
            <!--End Search Bar-->

            <div class="col-6 col-sm-4 col-md-4 col-lg-6 col-lx-6"></div>            
            <div class="col-3 col-sm-3 col-md-3 col-lg-3 col-lx-3 d-flex justify-content-end mb-3">
                <a class="btn btn-success" href="{% url 'create_leave' %}">
                    <i class="fas fa-plus-circle"></i>
                    Add New Leave
                </a>
            </div>            
            <div class="col-9 col-sm-9 col-md-9 col-lg-9 col-lx-9">
            </div>
        </div>
        <div class="table-responsive">
            <table class="sortable table table-bordered table-striped" id="dataTable" width="100%" cellspacing="0">
                <thead class="thead-dark">
                    <tr>
                        <th>Name</th>
                        <th>ACE</th>
                        <th>From</th>                        
                        <th>To</th>                                                                      
                        <th>Team</th>   
                        <th>Leave Type</th>                                             
                        <th>Actions</th>                                          
                    </tr>
                </thead>
                <tbody>
                    {% for leave in leaves %}
                    <tr>
                        <td><a href="#">{{ leave.employee.name }}</a></td>
                        <td>{{ leave.employee.ace }}</td>
                        <td>{{ leave.start_date }}</td>
                        <td>{{ leave.end_date }}</td>                        
                        <td>{{ leave.employee.team }}</td>          
                        <td>{{ leave.leave_type }}</td>          
                        <td>
                          <a href="{% url 'update_leave' pk=leave.id %}" title="Edit leave"><i class="fas fa-pencil-alt px-3"></i></a>                                
                          <a id="EmployeeDialog" class="open-AddBookDialog" href="#modalDeleteEmployee" data-toggle="modal" data-employee-name = "{{ leave.employee.name }} - ACE{{ leave.employee.ace }}" data-employee-id = "{{ leave.id }}" title="Delete leave"><i class="fas fa-trash px-3"></i></a>                                
                        </td>                                             
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
      </div>
    </div>
</div>


<!-- Delete modal-->
<div class="modal" id="modalDeleteEmployee">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content tx-size-sm">
        <div class="modal-body tx-center">
          <button
            aria-label="Close"
            class="close"
            data-dismiss="modal"
            type="button"
          >
            <span aria-hidden="true">&times;</span>
          </button>
          <i
            class="icon icon ion-ios-trash tx-100 tx-danger lh-1 mg-t-20 d-inline-block"
          ></i>
          <h4 class="tx-danger mg-b-20">Are you sure?</h4>
          <div class="modal-body">
            <p class="mg-b-20 mg-x-20">
              You will delete the guest card assigned to:
            </p>
            <input class="form-control" type="text" name="employee_to_delete" id="employee_to_delete" value="" disabled/>
            <p>
              This process can not be reverted
            </p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn ripple btn-light" data-dismiss="modal" type="button">
            No, cancel
          </button>
  
          <form id="form_id_employee" action="" method="POST">
            {% csrf_token %}
            <button class="btn ripple btn-danger">Yes, delete</button>
          </form>
        </div>
      </div>
    </div>
  </div>


<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>    
    //Delete Employee
    $(document).on("click", "#EmployeeDialog", function() {                         
        var myEmployeeId = $(this).data('employee-id');
        var myEmployeeName = $(this).data('employee-name');
        document.getElementById('employee_to_delete').innerHTML = myEmployeeName;          
        $(".modal-body #employee_to_delete").val(myEmployeeName);
        var newAction = "/employee/delete_leave/" + myEmployeeId + "/";        
        document.getElementById("form_id_employee").action = newAction;                                   
    });
</script>


{% endblock %}