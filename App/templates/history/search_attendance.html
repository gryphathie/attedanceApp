{% extends "base.html" %} 
{% load static %} 
{% load crispy_forms_tags %} 
{% block content %}

<style>
  table.sortable
    th:not(.sorttable_sorted):not(.sorttable_sorted_reverse):not(
      .sorttable_nosort
    ):after {
    content: " \25B4\25BE";
  }
</style>
<link
  href="http://cdn.jsdelivr.net/timepicker.js/latest/timepicker.min.css"
  rel="stylesheet"
/>

<body class="bg-gradient-dark">
  <div class="container-fluid">
    <!-- Outer Row -->
    <div class="row justify-content-center">
      <div class="col-xl-10 col-lg-12 col-mdd-9">
        <form method="POST">
          {% csrf_token %} {% for message in messages %}
          <div class="alert {{ message.tags }} mb-4" role="alert">
            <strong>{{ message }}</strong>
          </div>
          {% endfor %}
          <div class="card o-hidden border-left-info shadow-lg my-1">
            <div class="card-header text-center">
              <h1 class="h4 text-gray-900 mt-2">History</h1>
              <p>Search the employee attendance by date</p>
            </div>
            <div class="card-body p-0">
              <div class="row border border-primary rounded mx-3 my-2 pt-2">
                <div class="col-6 col-sm-12 col-md-6 col-lg-6">
                  <label>Employee Name</label>
                  {{ form.name }}
                </div>
                <div class="col-6 col-sm-12 col-md-6 col-lg-6">
                  <label>Card Number</label>
                  {{ form.card_number }}
                </div>
              </div>
              <div class="row border border-info rounded mx-3 my-2 pt-2">
                <div class="col-4 col-sm-6 col-md-4 col-lg-4">
                  <label>Date From</label>
                  {{ form.date_from }}
                </div>
                <div class="col-4 col-sm-6 col-md-4 col-lg-4">
                  <label>Date To</label>
                  {{ form.date_to }}
                </div>
                <div class="col-4 col-sm-12 col-md-4 col-lg-4">
                  <label>Show All Records</label>
                  {{ form.all_records }}
                </div>
              </div>                              
              <div class="row mx-2 my-3">
                <div class="col-12">
                  <button
                    class="btn btn-primary btn-lg"
                    type="submit"                    
                  >
                    <i class="fas fa-search fa-sm"></i> Search
                  </button>
                  <button
                    class="btn btn-success btn-lg"
                    type="submit"
                    name="generate_report"
                  >
                    <i class="fas fa-file-excel"></i> Export Report
                  </button>
                </div>
                <div class="col-12 pt-3">
                  {% comment %}
                  <a
                    class="btn btn-success btn-lg btn-block"
                    target="_blank"
                    href="{% url 'history_table' all_accounts=all_accounts account_number=account_number account_type=account_type all_dates=all_dates date_from=date_from date_to=date_to time_before=time_before time_past=time_past all_events=all_events event_1=event_1 event_2=event_2 %}"
                    ><i class="fas fa-table fa-sm pr-2"></i>Download Report</a
                  >
                  {% endcomment %}
                </div>
              </div>
            </div>
          </div>
        </form>

        <div class="row">
          <div class="col-8">
            <!-- Attendance Table -->
            <div class="card o-hidden border-left-dark shadow-lg my-5">
              <div class="card-header text-center">
                <h1 class="h4 text-primary my-2">Attendance Records</h1>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="sortable table table-striped table-hover">
                    <thead class="thead-dark">
                      <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Time</th>
                        <th scope="col">ACE</th>
                        <th scope="col">First Name</th>
                        <th scope="col">Last Name</th>
                        <th scope="col">Card Number</th>
                        <th scope="col">Device Name</th>
                        <th scope="col">Event Point</th>
                        <th scope="col">In Out Status</th>
                        <th scope="col">Event Description</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for record in history %}
                      <tr>
                        <td>{{ record.date }}</td>
                        <td>{{ record.time }}</td>
                        <td>{{ record.personnel_id }}</td>
                        <td>{{ record.first_name }}</td>
                        <td>{{ record.last_name }}</td>
                        <td>{{ record.card_number }}</td>
                        <td>{{ record.device_name }}</td>
                        <td>{{ record.event_point }}</td>
                        <td>{{ record.in_out_status }}</td>
                        <td>{{ record.event_description }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-4">
            <!-- Guest Card Table -->
            <div class="card o-hidden border-left-warning shadow-lg my-5">
              <div class="card-header text-center">
                <h1 class="h4 text-primary my-2">Guest Card Records</h1>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-striped table-hover">
                    <thead class="thead-dark">
                      <tr>
                        <th scope="col">Name</th>
                        <th scope="col">ACE</th>
                        <th scope="col">Guest Card</th>
                        <th scope="col">Start Date</th>
                        <th scope="col">End Date</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for guest in guests %}
                      <tr>
                        <td>{{ guest.employee.name }}</td>
                        <td>{{ guest.employee.ace }}</td>
                        <td>{{ guest.card_number }}</td>
                        <td>{{ guest.start_date }}</td>
                        <td>{{ guest.end_date }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Leaves Table -->
            <div class="card o-hidden border-left-success shadow-lg my-5">
              <div class="card-header text-center">
                <h1 class="h4 text-primary my-2">Leaves Requested</h1>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-striped table-hover">
                    <thead class="thead-dark">
                      <tr>
                        <th scope="col">Name</th>
                        <th scope="col">ACE</th>
                        <th scope="col">Start Date</th>
                        <th scope="col">End Date</th>
                        <th scope="col">Type</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for leave in leaves %}
                      <tr>
                        <td>{{ leave.employee.name }}</td>
                        <td>{{ leave.employee.ace }}</td>                        
                        <td>{{ leave.start_date }}</td>
                        <td>{{ leave.end_date }}</td>
                        <td>{{ leave.leave_type }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="//cdn.jsdelivr.net/timepicker.js/latest/timepicker.min.js"></script>

{% endblock %}
